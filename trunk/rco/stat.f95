!23456789012345678901234567890123456789012345678901234567890123456789012345678901234567890x

subroutine statv(t, s, rho, kk)

!=============================================================
!
!     statv !omputes one column of normalized densities from the
!     surface to level kk by using a 3rd order polynomial fit to
!     the equation of state.
!
!     note: for precision purposes, there is a depth dependent
!     constant subtracted from the density returned by this
!     routine.
!     so: this routine should be used only for calculating  
!     horizontal gradients of density or vertical stability
!     with adjacent levels referred to the same reference level.
!     reference level = surface level
!
!     inputs:
!
!     t = the input column of temperatures (degrees C)
!     s = the input column of salinities (units: (ppt-35)/1000)
!     kk = bottom level to be calculated
!
!     note: model salinities are equal to (s-35.0)/1000.0 where
!     s is the standard oceanographic salinity.  This convention,
!     which dates from the early Bryan and Cox model, increases 
!     the precision by about 5 binary bits.  This can be 
!     significant in density gradient calculations on 32-bit
!     computers.  The convention is also the one used by the
!     mom/gfdl program used to generate the include file  
!     'dncoef.h'.
!
!     output:
!
!     rho = density with depth level dependent offset 
!           (units: g/cc minus constant)

USE mod_param
IMPLICIT none

REAL t(km),s(km),rho(km)
REAL z0(km), rho0(km), to(km), so(km), c(km,9), tq, sq

INTEGER n,k,kk

INTEGER, PARAMETER ::  LSIG=1   ! define reference level sigma0=1

!====================== include file "dncoef.h" ========================

      data z0( 1), rho0( 1), to( 1), so( 1), (c( 1,n),n=1,9)/ &
                  1.50000E02,    1.0134264,   11.9998450,-.1700000E-01, &
               -.1558371E-03,0.7721498E+00,-.5695499E-05,-.2275458E-02, &
               0.2518764E-02,0.4725579E-07,0.6176542E-02,0.4244542E-04, &
               0.5894095E+01/

      data z0( 2), rho0( 2), to( 2), so( 2), (c( 2,n),n=1,9)/ &
                  4.50000E02,    1.0134404,   11.9995350,-.1700000E-01, &
               -.1559011E-03,0.7721279E+00,-.5694408E-05,-.2275102E-02, &
               0.2550381E-02,0.4724351E-07,0.6175614E-02,0.4243887E-04, &
               0.5894239E+01/
!
      data z0( 3), rho0( 3), to( 3), so( 3), (c( 3,n),n=1,9)/ &
                  7.50000E02,    1.0134543,   11.9992249,-.1700000E-01, &
               -.1559652E-03,0.7721061E+00,-.5693317E-05,-.2274747E-02, &
               0.2581990E-02,0.4723123E-07,0.6174685E-02,0.4243232E-04, &
               0.5894383E+01/
!
      data z0( 4), rho0( 4), to( 4), so( 4), (c( 4,n),n=1,9)/ &
                 10.50000E02,    1.0134683,   11.9989147,-.1700000E-01, &
               -.1560292E-03,0.7720843E+00,-.5692227E-05,-.2274391E-02, &
               0.2613593E-02,0.4721894E-07,0.6173757E-02,0.4242577E-04, &
               0.5894527E+01/
!
      data z0( 5), rho0( 5), to( 5), so( 5), (c( 5,n),n=1,9)/ &
                 13.50000E02,    1.0134822,   11.9986043,-.1700000E-01, &
               -.1560932E-03,0.7720625E+00,-.5691136E-05,-.2274035E-02, &
               0.2645188E-02,0.4720666E-07,0.6172828E-02,0.4241922E-04, &
               0.5894671E+01/
!
      data z0( 6), rho0( 6), to( 6), so( 6), (c( 6,n),n=1,9)/ &
                 16.50000E02,    1.0134961,   11.9982938,-.1700000E-01, &
               -.1561572E-03,0.7720407E+00,-.5690046E-05,-.2273680E-02, &
               0.2676776E-02,0.4719438E-07,0.6171900E-02,0.4241266E-04, &
               0.5894815E+01/
!
      data z0( 7), rho0( 7), to( 7), so( 7), (c( 7,n),n=1,9)/ &
                 19.50000E02,    1.0135101,   11.9979832,-.1700000E-01, &
               -.1562212E-03,0.7720189E+00,-.5688955E-05,-.2273324E-02, &
               0.2708356E-02,0.4718209E-07,0.6170971E-02,0.4240611E-04, &
               0.5894959E+01/
!
      data z0( 8), rho0( 8), to( 8), so( 8), (c( 8,n),n=1,9)/ &
                 22.50000E02,    1.0135240,   11.9976724,-.1700000E-01, &
               -.1562852E-03,0.7719971E+00,-.5687864E-05,-.2272968E-02, &
               0.2739929E-02,0.4716980E-07,0.6170042E-02,0.4239956E-04, &
               0.5895103E+01/
!
      data z0( 9), rho0( 9), to( 9), so( 9), (c( 9,n),n=1,9)/ &
                 25.50000E02,    1.0135380,   11.9973616,-.1700000E-01, &
               -.1563493E-03,0.7719753E+00,-.5686774E-05,-.2272613E-02, &
               0.2771495E-02,0.4715751E-07,0.6169112E-02,0.4239300E-04, &
               0.5895247E+01/
!
      data z0(10), rho0(10), to(10), so(10), (c(10,n),n=1,9)/ &
                 28.50000E02,    1.0135519,   11.9970506,-.1700000E-01, &
               -.1564133E-03,0.7719535E+00,-.5685683E-05,-.2272257E-02, &
               0.2803054E-02,0.4714522E-07,0.6168183E-02,0.4238644E-04, &
               0.5895392E+01/
!
      data z0(11), rho0(11), to(11), so(11), (c(11,n),n=1,9)/ &
                 31.50000E02,    1.0135658,   11.9967395,-.1700000E-01, &
               -.1564773E-03,0.7719318E+00,-.5684593E-05,-.2271901E-02, &
               0.2834605E-02,0.4713293E-07,0.6167253E-02,0.4237989E-04, &
               0.5895536E+01/
!
      data z0(12), rho0(12), to(12), so(12), (c(12,n),n=1,9)/ &
                 34.50000E02,    1.0135798,   11.9964283,-.1700000E-01, &
               -.1565413E-03,0.7719100E+00,-.5683502E-05,-.2271545E-02, &
               0.2866149E-02,0.4712064E-07,0.6166323E-02,0.4237333E-04, &
               0.5895681E+01/
!
      data z0(13), rho0(13), to(13), so(13), (c(13,n),n=1,9)/ &
                 37.50000E02,    1.0135937,   11.9961169,-.1700000E-01, &
               -.1566052E-03,0.7718882E+00,-.5682412E-05,-.2271189E-02, &
               0.2897685E-02,0.4710835E-07,0.6165393E-02,0.4236677E-04, &
               0.5895826E+01/
!
      data z0(14), rho0(14), to(14), so(14), (c(14,n),n=1,9)/ &
                 40.50000E02,    1.0136076,   11.9958054,-.1700000E-01, &
               -.1566692E-03,0.7718664E+00,-.5681321E-05,-.2270833E-02, &
               0.2929214E-02,0.4709605E-07,0.6164463E-02,0.4236022E-04, &
               0.5895971E+01/
!
      data z0(15), rho0(15), to(15), so(15), (c(15,n),n=1,9)/ &
                 43.50354E02,    1.0136216,   11.9954935,-.1700000E-01, &
               -.1567333E-03,0.7718446E+00,-.5680229E-05,-.2270477E-02, &
               0.2960773E-02,0.4708374E-07,0.6163531E-02,0.4235365E-04, &
               0.5896116E+01/
!
      data z0(16), rho0(16), to(16), so(16), (c(16,n),n=1,9)/ &
                 46.53887E02,    1.0136357,   11.9951781,-.1700000E-01, &
               -.1567980E-03,0.7718225E+00,-.5679126E-05,-.2270117E-02, &
               0.2992659E-02,0.4707130E-07,0.6162590E-02,0.4234701E-04, &
               0.5896263E+01/
!
      data z0(17), rho0(17), to(17), so(17), (c(17,n),n=1,9)/ &
                 49.65860E02,    1.0136502,   11.9948538,-.1700000E-01, &
               -.1568646E-03,0.7717999E+00,-.5677992E-05,-.2269746E-02, &
               0.3025424E-02,0.4705851E-07,0.6161622E-02,0.4234019E-04, &
               0.5896414E+01/
!
      data z0(18), rho0(18), to(18), so(18), (c(18,n),n=1,9)/ &
                 52.91781E02,    1.0136653,   11.9945148,-.1700000E-01, &
               -.1569341E-03,0.7717762E+00,-.5676807E-05,-.2269359E-02, &
               0.3059645E-02,0.4704515E-07,0.6160610E-02,0.4233306E-04, &
               0.5896572E+01/
!
      data z0(19), rho0(19), to(19), so(19), (c(19,n),n=1,9)/ &
                 56.36982E02,    1.0136813,   11.9941557,-.1700000E-01, &
               -.1570077E-03,0.7717511E+00,-.5675553E-05,-.2268950E-02, & 
               0.3095881E-02,0.4703099E-07,0.6159539E-02,0.4232551E-04, &
               0.5896739E+01/
!
      data z0(20), rho0(20), to(20), so(20), (c(20,n),n=1,9)/ &
                 60.06556E02,    1.0136985,   11.9937710,-.1700000E-01, &
               -.1570865E-03,0.7717243E+00,-.5674209E-05,-.2268511E-02, &
               0.3134664E-02,0.4701584E-07,0.6158392E-02,0.4231743E-04, &
               0.5896918E+01/
!
      data z0(21), rho0(21), to(21), so(21), (c(21,n),n=1,9)/ &
                 64.05286E02,    1.0137170,   11.9933558,-.1700000E-01, &
               -.1571715E-03,0.7716954E+00,-.5672760E-05,-.2268038E-02, &
               0.3176495E-02,0.4699949E-07,0.6157153E-02,0.4230871E-04, &
               0.5897112E+01/
!
      data z0(22), rho0(22), to(22), so(22), (c(22,n),n=1,9)/ &
                 68.37588E02,    1.0137371,   11.9929053,-.1700000E-01, &
               -.1572637E-03,0.7716640E+00,-.5671189E-05,-.2267524E-02, &
               0.3221833E-02,0.4698175E-07,0.6155811E-02,0.4229925E-04, &
               0.5897322E+01/
!
      data z0(23), rho0(23), to(23), so(23), (c(23,n),n=1,9)/ &
                 73.07459E02,    1.0137589,   11.9924155,-.1700000E-01, &
               -.1573638E-03,0.7716299E+00,-.5669481E-05,-.2266966E-02, &
               0.3271094E-02,0.4696248E-07,0.6154351E-02,0.4228897E-04, &
               0.5897550E+01/
!
      data z0(24), rho0(24), to(24), so(24), (c(24,n),n=1,9)/ &
                 78.18421E02,    1.0137826,   11.9918824,-.1700000E-01, &
               -.1574727E-03,0.7715928E+00,-.5667624E-05,-.2266359E-02, &
               0.3324643E-02,0.4694151E-07,0.6152763E-02,0.4227779E-04, &
               0.5897799E+01/
!
      data z0(25), rho0(25), to(25), so(25), (c(25,n),n=1,9)/ &
                 83.73480E02,    1.0138084,   11.9913029,-.1700000E-01, &
               -.1575910E-03,0.7715525E+00,-.5665606E-05,-.2265700E-02, &
               0.3382789E-02,0.4691873E-07,0.6151037E-02,0.4226564E-04, &
               0.5898070E+01/
!
      data z0(26), rho0(26), to(26), so(26), (c(26,n),n=1,9)/ &
                 89.75089E02,    1.0138363,   11.9906744,-.1700000E-01, &
               -.1577193E-03,0.7715089E+00,-.5663420E-05,-.2264985E-02, &
               0.3445783E-02,0.4689404E-07,0.6149166E-02,0.4225247E-04, &
               0.5898363E+01/
!
      data z0(27), rho0(27), to(27), so(27), (c(27,n),n=1,9)/ &
                 96.25112E02,    1.0138665,   11.9899947,-.1700000E-01, &
               -.1578578E-03,0.7714617E+00,-.5661058E-05,-.2264212E-02, &
               0.3513814E-02,0.4686735E-07,0.6147144E-02,0.4223824E-04, &
               0.5898681E+01/
!
      data z0(28), rho0(28), to(28), so(28), (c(28,n),n=1,9)/ &
                103.24808E02,    1.0138989,   11.9892624,-.1700000E-01, &
               -.1580069E-03,0.7714110E+00,-.5658515E-05,-.2263381E-02, &
               0.3587004E-02,0.4683862E-07,0.6144966E-02,0.4222291E-04, &
               0.5899024E+01/
!
      data z0(29), rho0(29), to(29), so(29), (c(29,n),n=1,9)/ &
                110.74808E02,    1.0139337,   11.9884768,-.1700000E-01, &
               -.1581666E-03,0.7713566E+00,-.5655789E-05,-.2262489E-02, &
               0.3665413E-02,0.4680781E-07,0.6142630E-02,0.4220648E-04, &
               0.5899391E+01/
!
      data z0(30), rho0(30), to(30), so(30), (c(30,n),n=1,9)/ &
                118.75112E02,    1.0139709,   11.9876376,-.1700000E-01, &
               -.1583371E-03,0.7712986E+00,-.5652881E-05,-.2261537E-02, &
               0.3749030E-02,0.4677493E-07,0.6140137E-02,0.4218895E-04, &
               0.5899785E+01/
!
      data z0(31), rho0(31), to(31), so(31), (c(31,n),n=1,9)/ &
                127.25089E02,    1.0140103,   11.9867454,-.1700000E-01, &
               -.1585181E-03,0.7712369E+00,-.5649792E-05,-.2260526E-02, &
               0.3837781E-02,0.4674000E-07,0.6137487E-02,0.4217032E-04, &
               0.5900203E+01/
!
      data z0(32), rho0(32), to(32), so(32), (c(32,n),n=1,9)/ &
                136.23480E02,    1.0140520,   11.9858013,-.1700000E-01, &
               -.1587095E-03,0.7711718E+00,-.5646528E-05,-.2259457E-02, &
               0.3931522E-02,0.4670307E-07,0.6134685E-02,0.4215063E-04, &
               0.5900646E+01/
!
      data z0(33), rho0(33), to(33), so(33), (c(33,n),n=1,9)/ &
                145.68421E02,    1.0140958,   11.9848071,-.1700000E-01, &
               -.1589106E-03,0.7711034E+00,-.5643094E-05,-.2258332E-02, &
               0.4030050E-02,0.4666422E-07,0.6131736E-02,0.4212991E-04, &
               0.5901113E+01/
!
      data z0(34), rho0(34), to(34), so(34), (c(34,n),n=1,9)/ &
                155.57459E02,    1.0141416,   11.9837652,-.1700000E-01, &
               -.1591212E-03,0.7710317E+00,-.5639501E-05,-.2257155E-02, &
               0.4133098E-02,0.4662354E-07,0.6128648E-02,0.4210822E-04, &
               0.5901603E+01/
!
      data z0(35), rho0(35), to(35), so(35), (c(35,n),n=1,9)/ &
                165.87588E02,    1.0141894,   11.9826786,-.1700000E-01, &
               -.1593404E-03,0.7709571E+00,-.5635758E-05,-.2255928E-02, &
               0.4240343E-02,0.4658116E-07,0.6125430E-02,0.4208562E-04, &
               0.5902114E+01/
!
      data z0(36), rho0(36), to(36), so(36), (c(36,n),n=1,9)/ &
                176.55285E02,    1.0142389,   11.9815508,-.1700000E-01, &
               -.1595676E-03,0.7708798E+00,-.5631879E-05,-.2254656E-02, &
               0.4351407E-02,0.4653721E-07,0.6122092E-02,0.4206219E-04, &
               0.5902645E+01/
!
      data z0(37), rho0(37), to(37), so(37), (c(37,n),n=1,9)/ &
                187.56555E02,    1.0142899,   11.9803860,-.1700000E-01, &
               -.1598019E-03,0.7708000E+00,-.5627879E-05,-.2253343E-02, &
               0.4465867E-02,0.4649187E-07,0.6118646E-02,0.4203802E-04, &
               0.5903194E+01/
!
      data z0(38), rho0(38), to(38), so(38), (c(38,n),n=1,9)/ &
                198.86980E02,    1.0143423,   11.9791886,-.1700000E-01, &
               -.1600424E-03,0.7707182E+00,-.5623772E-05,-.2251996E-02, &
               0.4583255E-02,0.4644531E-07,0.6115107E-02,0.4201320E-04, &
               0.5903759E+01/
!
      data z0(39), rho0(39), to(39), so(39), (c(39,n),n=1,9)/ &
                210.41779E02,    1.0143958,   11.9779636,-.1700000E-01, &
               -.1602880E-03,0.7706347E+00,-.5619578E-05,-.2250618E-02, &
               0.4703067E-02,0.4639774E-07,0.6111490E-02,0.4198783E-04, &
               0.5904338E+01/
!
      data z0(40), rho0(40), to(40), so(40), (c(40,n),n=1,9)/ &
                222.15859E02,    1.0144501,   11.9767163,-.1700000E-01, &
               -.1605376E-03,0.7705497E+00,-.5615313E-05,-.2249218E-02, &
               0.4824767E-02,0.4634935E-07,0.6107809E-02,0.4196203E-04, &
               0.5904928E+01/
!
      data z0(41), rho0(41), to(41), so(41), (c(41,n),n=1,9)/ &
                234.03887E02,    1.0145052,   11.9754523,-.1700000E-01, &
               -.1607902E-03,0.7704638E+00,-.5610999E-05,-.2247800E-02, &
               0.4947800E-02,0.4630036E-07,0.6104082E-02,0.4193592E-04, &
               0.5905526E+01/
!

!  the above coefficients were calculated using program "eqstat"
!  employing the UNESCO equation of state.
!  They are valid for the following depths and T and S ranges
!     k      depth        tmin      tmax           smin      smax
!     1       1.50e2     -2.000    26.000         0.0000   36.0000
!     2       4.50e2     -2.000    26.000         0.0000   36.0000
!     3       7.50e2     -2.000    26.000         0.0000   36.0000
!     4      10.50e2     -2.000    26.000         0.0000   36.0000
!     5      13.50e2     -2.000    26.000         0.0000   36.0000
!     6      16.50e2     -2.000    26.000         0.0000   36.0000
!     7      19.50e2     -2.000    26.000         0.0000   36.0000
!     8      22.50e2     -2.000    26.000         0.0000   36.0000
!     9      25.50e2     -2.000    26.000         0.0000   36.0000
!    10      28.50e2     -2.000    26.000         0.0000   36.0000
!    11      31.50e2     -2.000    26.000         0.0000   36.0000
!    12      34.50e2     -2.000    26.000         0.0000   36.0000
!    13      37.50e2     -2.000    26.000         0.0000   36.0000
!    14      40.50e2     -2.000    26.000         0.0000   36.0000
!    15      43.50e2     -2.000    26.000         0.0000   36.0000
!    16      46.54e2     -2.000    26.000         0.0000   36.0000
!    17      49.66e2     -2.000    26.000         0.0000   36.0000
!    18      52.92e2     -2.000    26.000         0.0000   36.0000
!    19      56.37e2     -2.000    26.000         0.0000   36.0000
!    20      60.07e2     -2.000    26.000         0.0000   36.0000
!    21      64.05e2     -2.000    26.000         0.0000   36.0000
!    22      68.38e2     -2.000    26.000         0.0000   36.0000
!    23      73.07e2     -2.000    26.000         0.0000   36.0000
!    24      78.18e2     -2.000    26.000         0.0000   36.0000
!    25      83.73e2     -2.000    26.000         0.0000   36.0000
!    26      89.75e2     -2.000    26.000         0.0000   36.0000
!    27      96.25e2     -2.000    26.000         0.0000   36.0000
!    28     103.25e2     -2.000    26.000         0.0000   36.0000
!    29     110.75e2     -2.000    26.000         0.0000   36.0000
!    30     118.75e2     -2.000    26.000         0.0000   36.0000
!    31     127.25e2     -2.000    26.000         0.0000   36.0000
!    32     136.23e2     -2.000    26.000         0.0000   36.0000
!    33     145.68e2     -2.000    26.000         0.0000   36.0000
!    34     155.57e2     -2.000    26.000         0.0000   36.0000
!    35     165.88e2     -2.000    26.000         0.0000   36.0000
!    36     176.55e2     -2.000    26.000         0.0000   36.0000
!    37     187.57e2     -2.000    26.000         0.0000   36.0000
!    38     198.87e2     -2.000    26.000         0.0000   36.0000
!    39     210.42e2     -2.000    26.000         0.0000   36.0000
!    40     222.16e2     -2.000    26.000         0.0000   36.0000
!    41     234.04e2     -2.000    26.000         0.0000   36.0000
!
!  the 3rd order polynomial will return density departures [gm/cm**3] as
!  a function of potential temperature [deg C] & salinity [model units]
!
!       k level reference densities (in sigma units):
!   13.4264 13.4404 13.4543 13.4683 13.4822 13.4961 13.5101 13.5240
!   13.5380 13.5519 13.5658 13.5798 13.5937 13.6076 13.6216 13.6357
!   13.6502 13.6653 13.6813 13.6985 13.7170 13.7371 13.7589 13.7826
!   13.8084 13.8363 13.8665 13.8989 13.9337 13.9709 14.0103 14.0520
!   14.0958 14.1416 14.1894 14.2389 14.2899 14.3423 14.3958 14.4501
!   14.5052
!
!  normal entry

      do 400 k=1,kk
       tq=t(k)-to(lsig)
       sq=s(k)-so(lsig)
       rho(k) = (c(lsig,1) + (c(lsig,4) + c(lsig,7)*sq)*sq +  &
                (c(lsig,3) + c(lsig,8)*sq + c(lsig,6)*tq)*tq)*tq + &
                (c(lsig,2) + (c(lsig,5) + c(lsig,9)*sq)*sq)*sq
       rho(k) = 1000.*(rho(k)+rho0(lsig)-1.)
!       print *,k,rho(k),t(k),s(k),tq,sq,rho0(lsig),c(lsig,1),c(lsig,2),
!     &         c(lsig,3),c(lsig,4),c(lsig,5),c(lsig,6),c(lsig,7)
!     &        ,c(lsig,8),c(lsig,9)
       if(rho(k).gt.2000.) stop 23456
 400   continue


return
end subroutine statv

!_______________________________________________________________________
 
